<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAS Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            background: #ffebee;
            color: #c62828;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Google Apps Script デバッグテスト</h1>
        
        <div>
            <label>GAS URL:</label>
            <input type="text" id="gasUrl" value="https://script.google.com/macros/s/AKfycbxufN4CPujE75vKqgeMqKMhumfFm9HE4j4pN0sZMSaKJGXS7wP5vp6P1d5jKgz8LIne/exec" style="font-size: 12px;">
        </div>

        <h2>テストデータ</h2>
        <form id="testForm">
            <label>会社名:</label>
            <input type="text" id="company" value="テスト株式会社">
            
            <label>お名前:</label>
            <input type="text" id="name" value="テスト太郎">
            
            <label>メール:</label>
            <input type="email" id="email" value="test@example.com">
            
            <label>電話番号:</label>
            <input type="tel" id="phone" value="03-1234-5678">
            
            <label>メッセージ:</label>
            <textarea id="message" rows="3">これはデバッグテストです。</textarea>
        </form>

        <button onclick="testNoCors()">1. no-cors モードでテスト（本番と同じ）</button>
        <button onclick="testCors()">2. cors モードでテスト（エラー詳細確認）</button>
        <button onclick="testGet()">3. GET リクエストでテスト</button>
        <button onclick="checkGAS()">4. GAS の生存確認</button>

        <div id="result" class="result"></div>
    </div>

    <script>
        const resultDiv = document.getElementById('result');
        
        function getFormData() {
            return {
                timestamp: new Date().toLocaleString('ja-JP'),
                company: document.getElementById('company').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                inquiry_type: 'テスト',
                message: document.getElementById('message').value,
                source_url: window.location.href,
                privacy: 'yes'
            };
        }

        function showResult(message, isError = false) {
            resultDiv.className = 'result ' + (isError ? 'error' : 'success');
            resultDiv.textContent = message;
        }

        async function testNoCors() {
            showResult('送信中...');
            const url = document.getElementById('gasUrl').value;
            const data = getFormData();
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify(data)
                });
                
                showResult(`✅ 送信完了\n\nno-corsモードのため、レスポンスは確認できません。\nスプレッドシートを確認してください。\n\n送信データ:\n${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                showResult(`❌ エラー: ${error.message}`, true);
            }
        }

        async function testCors() {
            showResult('送信中...');
            const url = document.getElementById('gasUrl').value;
            const data = getFormData();
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const text = await response.text();
                showResult(`レスポンス (${response.status}):\n${text}`);
            } catch (error) {
                showResult(`❌ CORSエラー（予想通り）:\n${error.message}\n\nこれは正常です。GASはCORSを許可していません。`, true);
            }
        }

        async function testGet() {
            showResult('確認中...');
            const url = document.getElementById('gasUrl').value;
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                showResult(`GETリクエスト送信完了\n\nGASがdoGet()関数を実装していない場合、エラーになります。`);
            } catch (error) {
                showResult(`❌ エラー: ${error.message}`, true);
            }
        }

        async function checkGAS() {
            const url = document.getElementById('gasUrl').value;
            showResult(`GAS URL: ${url}\n\n確認事項:\n1. URLが正しいか\n2. デプロイが完了しているか\n3. アクセス権限が「全員」になっているか\n4. 実行ユーザーが「自分」になっているか`);
        }

        // ページ読み込み時の情報表示
        window.onload = function() {
            showResult('テストの準備ができました。\n\n使い方:\n1. 「no-cors モードでテスト」をクリック\n2. Google スプレッドシートを確認\n3. データが入っていない場合は、他のテストボタンを試す');
        };
    </script>
</body>
</html>