const fs = require('fs').promises;
const path = require('path');

// AIÃ—å¿ƒç†å­¦ã«åŸºã¥ãã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆæ”¯æ´
class BlogAIAssistant {
  constructor() {
    // 8ã¤ã®æœ¬èƒ½ã¨ãã®ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°å¿œç”¨
    this.instinctStrategies = {
      'ç”Ÿå­˜æœ¬èƒ½': {
        triggers: ['å®‰å…¨', 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£', 'ãƒªã‚¹ã‚¯', 'ä¿è­·', 'ä¿¡é ¼'],
        patterns: [
          'ãƒªã‚¹ã‚¯ã‚’å›žé¿ã—ã€å®‰å…¨æ€§ã‚’ç¢ºä¿ã™ã‚‹æ–¹æ³•',
          'ä¿¡é ¼ã§ãã‚‹ãƒ–ãƒ©ãƒ³ãƒ‰ã¨ã—ã¦ã®åœ°ä½ç¢ºç«‹',
          'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã«ã‚ˆã‚‹é¡§å®¢ã®å®‰å¿ƒæ„Ÿå‘ä¸Š'
        ],
        hooks: [
          'ä»Šã™ãå¯¾ç­–ã—ãªã„ã¨æ‰‹é…ã‚Œã«ãªã‚‹ç†ç”±',
          'å¤šãã®ä¼æ¥­ãŒè¦‹è½ã¨ã—ã¦ã„ã‚‹è‡´å‘½çš„ãªãƒªã‚¹ã‚¯',
          'å®‰å…¨æ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ'
        ]
      },
      'é£Ÿæ¬²æœ¬èƒ½': {
        triggers: ['æº€è¶³', 'å……å®Ÿ', 'è±Šã‹ã•', 'å“è³ª', 'ä¾¡å€¤'],
        patterns: [
          'é¡§å®¢æº€è¶³åº¦ã‚’æœ€å¤§åŒ–ã™ã‚‹ä»•çµ„ã¿',
          'ä¾¡å€¤æä¾›ã«ã‚ˆã‚‹å·®åˆ¥åŒ–æˆ¦ç•¥',
          'å“è³ªå‘ä¸ŠãŒã‚‚ãŸã‚‰ã™é•·æœŸçš„ãªåˆ©ç›Š'
        ],
        hooks: [
          'é¡§å®¢ãŒæœ¬å½“ã«æ±‚ã‚ã¦ã„ã‚‹ä¾¡å€¤ã¨ã¯',
          'æº€è¶³åº¦ã‚’åŠ‡çš„ã«å‘ä¸Šã•ã›ã‚‹æ„å¤–ãªæ–¹æ³•',
          'ç«¶åˆä»–ç¤¾ã¨ã®å“è³ªå·®ã‚’ç”Ÿã¿å‡ºã™ç§˜è¨£'
        ]
      },
      'æ€§çš„æœ¬èƒ½': {
        triggers: ['é­…åŠ›', 'ç¾Žã—ã•', 'ãƒ‡ã‚¶ã‚¤ãƒ³', 'ã‚¨ãƒ¬ã‚¬ãƒ³ã‚¹', 'æ´—ç·´'],
        patterns: [
          'ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã«ã‚ˆã‚‹è¨´æ±‚åŠ›å‘ä¸Š',
          'ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æ´—ç·´ã¨å·®åˆ¥åŒ–',
          'æ„Ÿæ€§ã«è¨´ãˆã‚‹ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‰‹æ³•'
        ],
        hooks: [
          'ä¸€ç›®ã§å¿ƒã‚’æŽ´ã‚€ãƒ‡ã‚¶ã‚¤ãƒ³ã®æ³•å‰‡',
          'é«˜ç´šæ„Ÿã‚’æ¼”å‡ºã™ã‚‹5ã¤ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯',
          'ç¾Žã—ã•ãŒå£²ä¸Šã«ç›´çµã™ã‚‹ç†ç”±'
        ]
      },
      'å±æ©Ÿå›žé¿æœ¬èƒ½': {
        triggers: ['äºˆé˜²', 'å¯¾ç­–', 'å•é¡Œè§£æ±º', 'æ”¹å–„', 'æœ€é©åŒ–'],
        patterns: [
          'å•é¡Œã‚’æœªç„¶ã«é˜²ããƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ–½ç­–',
          'ãƒˆãƒ©ãƒ–ãƒ«å›žé¿ã®ãŸã‚ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰',
          'ç¶™ç¶šçš„æ”¹å–„ã«ã‚ˆã‚‹ç«¶äº‰å„ªä½æ€§'
        ],
        hooks: [
          'å¤±æ•—ã™ã‚‹å‰ã«çŸ¥ã£ã¦ãŠãã¹ãã“ã¨',
          'å•é¡ŒãŒèµ·ãã¦ã‹ã‚‰ã§ã¯é…ã„ç†ç”±',
          'äºˆé˜²ã«æŠ•è³‡ã™ã‚‹ã“ã¨ã®çœŸã®ä¾¡å€¤'
        ]
      },
      'å¿«é©æœ¬èƒ½': {
        triggers: ['ä¾¿åˆ©', 'åŠ¹çŽ‡', 'è‡ªå‹•åŒ–', 'ç°¡å˜', 'ã‚¹ãƒžãƒ¼ãƒˆ'],
        patterns: [
          'ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šã«ã‚ˆã‚‹é¡§å®¢ç²å¾—',
          'æ¥­å‹™åŠ¹çŽ‡åŒ–ãŒã‚‚ãŸã‚‰ã™ç«¶äº‰å„ªä½',
          'AIæ´»ç”¨ã«ã‚ˆã‚‹è‡ªå‹•åŒ–ã®å®Ÿç¾'
        ],
        hooks: [
          'æ‰‹é–“ã‚’90%å‰Šæ¸›ã™ã‚‹é©æ–°çš„ãªæ–¹æ³•',
          'ãªãœä¾¿åˆ©ã•ãŒæœ€å¼·ã®å·®åˆ¥åŒ–è¦å› ãªã®ã‹',
          'è‡ªå‹•åŒ–ã§å®Ÿç¾ã™ã‚‹ç†æƒ³ã®ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«'
        ]
      },
      'æ„›æƒ…æœ¬èƒ½': {
        triggers: ['ã¤ãªãŒã‚Š', 'ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£', 'å…±æ„Ÿ', 'ã‚µãƒãƒ¼ãƒˆ', 'é–¢ä¿‚æ€§'],
        patterns: [
          'ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®æ§‹ç¯‰',
          'é¡§å®¢ã¨ã®æ·±ã„é–¢ä¿‚æ€§ã®è‚²æˆ',
          'å…±æ„Ÿã‚’ç”Ÿã‚€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ãƒªãƒ³ã‚°'
        ],
        hooks: [
          'ãƒ•ã‚¡ãƒ³ãŒè‡ªç„¶ã«å¢—ãˆã‚‹ä»•çµ„ã¿ã¥ãã‚Š',
          'é¡§å®¢ãŒå‹äººã«å‹§ã‚ãŸããªã‚‹ç†ç”±',
          'ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®åŠ›ã§å£²ä¸Šã‚’å€å¢—ã•ã›ã‚‹æ–¹æ³•'
        ]
      },
      'æ‰¿èªæœ¬èƒ½': {
        triggers: ['æˆåŠŸ', 'å®Ÿç¸¾', 'è©•ä¾¡', 'ãƒ–ãƒ©ãƒ³ãƒ‰', 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹'],
        patterns: [
          'ãƒ–ãƒ©ãƒ³ãƒ‰ä¾¡å€¤å‘ä¸Šã«ã‚ˆã‚‹å·®åˆ¥åŒ–',
          'å®Ÿç¸¾ã‚’æ´»ç”¨ã—ãŸä¿¡é ¼æ€§ã®æ§‹ç¯‰',
          'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚·ãƒ³ãƒœãƒ«ã¨ã—ã¦ã®ä½ç½®ã¥ã‘'
        ],
        hooks: [
          'é¸ã°ã‚Œã‚‹ä¼æ¥­ã«ãªã‚‹ãŸã‚ã®æ¡ä»¶',
          'å®Ÿç¸¾ãŒé›ªã ã‚‹ã¾å¼ã«å¢—ãˆã‚‹ä»•çµ„ã¿',
          'ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›ã§ä¾¡æ ¼ç«¶äº‰ã‹ã‚‰è„±å´ã™ã‚‹æ–¹æ³•'
        ]
      },
      'å­¦ç¿’æœ¬èƒ½': {
        triggers: ['çŸ¥è­˜', 'æˆé•·', 'ã‚¹ã‚­ãƒ«', 'é©æ–°', 'ãƒˆãƒ¬ãƒ³ãƒ‰'],
        patterns: [
          'æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æ´»ç”¨ã—ãŸå…ˆè¡Œè€…åˆ©ç›Š',
          'ç¶™ç¶šçš„å­¦ç¿’ã«ã‚ˆã‚‹çµ„ç¹”ã®æˆé•·',
          'ã‚¤ãƒŽãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿã‚€ç’°å¢ƒã¥ãã‚Š'
        ],
        hooks: [
          'çŸ¥ã‚‰ãªã„ã¨æã™ã‚‹æœ€æ–°ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‰‹æ³•',
          'ç«¶åˆã«å·®ã‚’ã¤ã‘ã‚‹å­¦ç¿’æˆ¦ç•¥',
          'ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å…ˆå–ã‚Šã—ã¦å¸‚å ´ã‚’åˆ¶ã™ã‚‹æ–¹æ³•'
        ]
      }
    };

    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—åˆ¥ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    this.contentTemplates = {
      'introduction': {
        structure: [
          'èª­è€…ã®èª²é¡Œã‚„æ‚©ã¿ã«å…±æ„Ÿ',
          'è¨˜äº‹ã§å¾—ã‚‰ã‚Œã‚‹ãƒ¡ãƒªãƒƒãƒˆã®æç¤º',
          'ä¿¡é ¼æ€§ã‚’ç¤ºã™æ ¹æ‹ ã‚„å®Ÿç¸¾'
        ],
        example: 'å¤šãã®ä¼æ¥­ãŒ[èª²é¡Œ]ã§æ‚©ã‚“ã§ã„ã¾ã™ã€‚å®Ÿã¯ã€[æœ¬èƒ½]ã«è¨´æ±‚ã™ã‚‹ã“ã¨ã§ã€ã“ã®å•é¡Œã¯é©šãã»ã©ç°¡å˜ã«è§£æ±ºã§ãã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€å®Ÿéš›ã«[æˆæžœ]ã‚’é”æˆã—ãŸæ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚'
      },
      'body': {
        structure: [
          'ç†è«–çš„èƒŒæ™¯ã®èª¬æ˜Ž',
          'å…·ä½“çš„ãªå®Ÿè·µæ–¹æ³•',
          'æˆåŠŸäº‹ä¾‹ã®ç´¹ä»‹',
          'æ³¨æ„ç‚¹ã‚„ã‚ˆãã‚ã‚‹å¤±æ•—'
        ]
      },
      'conclusion': {
        structure: [
          'è¦ç‚¹ã®ã¾ã¨ã‚',
          'è¡Œå‹•ã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
          'CTAï¼ˆã‚³ãƒ¼ãƒ«ãƒˆã‚¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰'
        ],
        example: '[æœ¬èƒ½]ã«è¨´æ±‚ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€[å…·ä½“çš„ãªæˆæžœ]ã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚ã¾ãšã¯[ç°¡å˜ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³]ã‹ã‚‰å§‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚'
      }
    };

    // SEOæœ€é©åŒ–ã®ãŸã‚ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æˆ¦ç•¥
    this.seoStrategies = {
      'title': {
        patterns: [
          '[æ•°å­—]ã¤ã®[ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰]ã§[æˆæžœ]ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•',
          'ãªãœ[ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰]ãŒ[æ¥­ç•Œ]ã§é‡è¦ãªã®ã‹',
          '[å¹´]å¹´ç‰ˆï¼š[ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰]ã®å®Œå…¨ã‚¬ã‚¤ãƒ‰',
          '[ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰]ã§å¤±æ•—ã—ãªã„ãŸã‚ã®[æ•°å­—]ã¤ã®ãƒã‚¤ãƒ³ãƒˆ'
        ]
      },
      'meta_description': {
        maxLength: 150,
        structure: '[å•é¡Œæèµ·]ã€‚[è§£æ±ºç­–ã®æç¤º]ã€‚[è¡Œå‹•å–šèµ·]ã€‚'
      }
    };
  }

  // ã‚¿ã‚¤ãƒˆãƒ«å€™è£œã‚’ç”Ÿæˆ
  generateTitleSuggestions(instinct, category, keywords) {
    const suggestions = [];
    const instinctData = this.instinctStrategies[instinct];
    
    // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹ã®ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ
    const patterns = [
      `${category}ã§${instinct}ã‚’åˆºæ¿€ã™ã‚‹${Math.floor(Math.random() * 5) + 3}ã¤ã®æ–¹æ³•`,
      `ãªãœ${instinctData.triggers[0]}ãŒ${category}ã®æˆåŠŸã®éµãªã®ã‹`,
      `${new Date().getFullYear()}å¹´ã®${category}ï¼š${instinctData.triggers[1]}ã‚’é‡è¦–ã™ã¹ãç†ç”±`,
      `${instinct}Ã—AIï¼šæ¬¡ä¸–ä»£ã®${category}æˆ¦ç•¥`,
      `å®Ÿè·µï¼${instinctData.triggers[2]}ã‚’æ´»ç”¨ã—ãŸ${category}ã®æˆåŠŸäº‹ä¾‹`,
      `${category}ã®å¸¸è­˜ã‚’è¦†ã™${instinct}ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°`,
      `ãƒ‡ãƒ¼ã‚¿ã§è¨¼æ˜Žï¼š${instinct}ãŒ${category}ã«ä¸Žãˆã‚‹å½±éŸ¿`,
      `ãƒ—ãƒ­ãŒæ•™ãˆã‚‹${instinct}ã‚’ä½¿ã£ãŸ${category}ã®æ¥µæ„`
    ];

    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ã‚¿ã‚¤ãƒˆãƒ«ã‚‚ç”Ÿæˆ
    if (keywords && keywords.length > 0) {
      patterns.push(`${keywords[0]}ã§å®Ÿç¾ã™ã‚‹é©æ–°çš„ãª${category}`);
      patterns.push(`${keywords[0]}Ã—${keywords[1]}ï¼šæœ€å¼·ã®çµ„ã¿åˆã‚ã›`);
    }

    return patterns.slice(0, 5);
  }

  // ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ç”Ÿæˆ
  generateOutline(instinct, template, title) {
    const instinctData = this.instinctStrategies[instinct];
    const outline = [];

    switch (template) {
      case 'how-to':
        outline.push({
          section: 'å•é¡Œæèµ·',
          content: `å¤šãã®ä¼æ¥­ãŒç›´é¢ã™ã‚‹${instinct}ã«é–¢ã™ã‚‹èª²é¡Œã¨ã€ãã‚ŒãŒå¼•ãèµ·ã“ã™æ©Ÿä¼šæå¤±ã«ã¤ã„ã¦èª¬æ˜Ž`,
          tips: instinctData.hooks[0]
        });
        outline.push({
          section: 'è§£æ±ºç­–ã®æ¦‚è¦',
          content: `${instinct}ã‚’æ´»ç”¨ã—ãŸAIÃ—å¿ƒç†å­¦ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®å…¨ä½“åƒã‚’æç¤º`,
          tips: 'LeadFiveã®ç‹¬è‡ªãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç°¡æ½”ã«ç´¹ä»‹'
        });
        outline.push({
          section: 'ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—',
          content: `å®Ÿè·µçš„ãª${instinctData.patterns[0]}ã®å…·ä½“çš„æ‰‹é †`,
          tips: 'å„ã‚¹ãƒ†ãƒƒãƒ—ã«å…·ä½“ä¾‹ã‚’å«ã‚ã‚‹'
        });
        break;

      case 'analysis':
        outline.push({
          section: 'ç¾çŠ¶åˆ†æž',
          content: `${instinct}ãŒç¾ä»£ã®ãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã«ä¸Žãˆã‚‹å½±éŸ¿ã®åˆ†æž`,
          tips: 'æœ€æ–°ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚„èª¿æŸ»çµæžœã‚’æ´»ç”¨'
        });
        outline.push({
          section: 'ãƒ‡ãƒ¼ã‚¿ãƒ»æ ¹æ‹ ',
          content: `${instinct}ã®åŠ¹æžœã‚’è£ä»˜ã‘ã‚‹ç§‘å­¦çš„æ ¹æ‹ ã¨ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£`,
          tips: 'ä¿¡é ¼ã§ãã‚‹ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®å¼•ç”¨ã‚’å«ã‚ã‚‹'
        });
        break;

      case 'case-study':
        outline.push({
          section: 'èƒŒæ™¯',
          content: `ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæŠ±ãˆã¦ã„ãŸ${instinct}ã«é–¢ã™ã‚‹èª²é¡Œ`,
          tips: 'èª­è€…ãŒå…±æ„Ÿã§ãã‚‹å…·ä½“çš„ãªçŠ¶æ³è¨­å®š'
        });
        outline.push({
          section: 'è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ',
          content: `${instinctData.patterns[1]}ã®å®Ÿè£…éŽç¨‹`,
          tips: 'AIæŠ€è¡“ã®å…·ä½“çš„ãªæ´»ç”¨æ–¹æ³•ã‚’èª¬æ˜Ž'
        });
        break;
    }

    return outline;
  }

  // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—
  enhanceContent(content, instinct, keywords) {
    const instinctData = this.instinctStrategies[instinct];
    let enhanced = content;

    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®è‡ªç„¶ãªæŒ¿å…¥
    keywords.forEach(keyword => {
      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯è¿½åŠ ã‚’ææ¡ˆ
      if (!enhanced.includes(keyword)) {
        enhanced += `\n\nðŸ’¡ ãƒ’ãƒ³ãƒˆ: "${keyword}"ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªç„¶ã«å«ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`;
      }
    });

    // æœ¬èƒ½ã«é–¢é€£ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ã‚ºã®è¿½åŠ ææ¡ˆ
    enhanced += '\n\n### è¿½åŠ ã§å«ã‚ã‚‹ã¨åŠ¹æžœçš„ãªãƒ•ãƒ¬ãƒ¼ã‚º:\n';
    instinctData.hooks.forEach(hook => {
      enhanced += `- ${hook}\n`;
    });

    // CTAï¼ˆCall to Actionï¼‰ã®ææ¡ˆ
    enhanced += '\n\n### åŠ¹æžœçš„ãªCTAã®ä¾‹:\n';
    enhanced += `- ã€Œ${instinct}ã‚’æ´»ç”¨ã—ãŸãƒžãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥ã«ã¤ã„ã¦ã€ç„¡æ–™ç›¸è«‡ã‚’å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€\n`;
    enhanced += `- ã€Œã‚ãªãŸã®ãƒ“ã‚¸ãƒã‚¹ã«${instinctData.triggers[0]}ã‚’ã‚‚ãŸã‚‰ã™æ–¹æ³•ã‚’ã€ä»Šã™ãç¢ºèªã—ã¾ã—ã‚‡ã†ã€\n`;

    return enhanced;
  }

  // SEOæœ€é©åŒ–
  optimizeForSEO(title, description, keywords, instinct) {
    const suggestions = {
      title: title,
      description: description,
      improvements: []
    };

    // ã‚¿ã‚¤ãƒˆãƒ«ã®æœ€é©åŒ–ãƒã‚§ãƒƒã‚¯
    if (title.length > 60) {
      suggestions.improvements.push('ã‚¿ã‚¤ãƒˆãƒ«ãŒé•·ã™ãŽã¾ã™ã€‚60æ–‡å­—ä»¥å†…ã«åŽã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚');
    }
    if (!title.includes(keywords[0])) {
      suggestions.improvements.push(`ãƒ¡ã‚¤ãƒ³ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€Œ${keywords[0]}ã€ã‚’ã‚¿ã‚¤ãƒˆãƒ«ã«å«ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`);
    }

    // ãƒ¡ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®æœ€é©åŒ–
    if (description.length > 150) {
      suggestions.improvements.push('èª¬æ˜Žæ–‡ãŒé•·ã™ãŽã¾ã™ã€‚150æ–‡å­—ä»¥å†…ã«åŽã‚ã¦ãã ã•ã„ã€‚');
    }
    if (!description.includes(instinct)) {
      suggestions.improvements.push(`ã€Œ${instinct}ã€ã¨ã„ã†é‡è¦ãªæ¦‚å¿µã‚’èª¬æ˜Žæ–‡ã«å«ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`);
    }

    // æœ€é©åŒ–ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ææ¡ˆ
    if (suggestions.improvements.length > 0) {
      const instinctData = this.instinctStrategies[instinct];
      suggestions.optimizedTitle = `${keywords[0]}ã§${instinctData.triggers[0]}ã‚’å®Ÿç¾ï½œ${title.substring(0, 40)}`;
      suggestions.optimizedDescription = `${instinct}ã«åŸºã¥ã${keywords[0]}ã®æ´»ç”¨æ³•ã‚’è§£èª¬ã€‚${description.substring(0, 100)}...è©³ç´°ã¯ã“ã¡ã‚‰`;
    }

    return suggestions;
  }

  // è¨˜äº‹ã®å“è³ªã‚¹ã‚³ã‚¢ç®—å‡º
  calculateQualityScore(postData) {
    let score = 0;
    const feedback = [];

    // ã‚¿ã‚¤ãƒˆãƒ«ã®è©•ä¾¡
    if (postData.title.length >= 20 && postData.title.length <= 60) {
      score += 20;
    } else {
      feedback.push('ã‚¿ã‚¤ãƒˆãƒ«ã®é•·ã•ã‚’20-60æ–‡å­—ã«èª¿æ•´ã—ã¾ã—ã‚‡ã†');
    }

    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä½¿ç”¨
    if (postData.keywords.length >= 3 && postData.keywords.length <= 7) {
      score += 15;
    } else {
      feedback.push('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯3-7å€‹ãŒé©åˆ‡ã§ã™');
    }

    // ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®å……å®Ÿåº¦
    if (postData.outline.length >= 4) {
      score += 25;
    } else {
      feedback.push('è¨˜äº‹ã®æ§‹æˆã‚’ã‚‚ã†å°‘ã—è©³ç´°ã«ã—ã¾ã—ã‚‡ã†');
    }

    // æœ¬èƒ½ã®æ´»ç”¨
    if (postData.instinct) {
      score += 20;
    }

    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å®Œæˆåº¦
    if (postData.description && postData.description.length >= 100) {
      score += 20;
    } else {
      feedback.push('SEOç”¨ã®èª¬æ˜Žæ–‡ã‚’ã‚‚ã†å°‘ã—è©³ã—ãæ›¸ãã¾ã—ã‚‡ã†');
    }

    return {
      score,
      grade: score >= 80 ? 'A' : score >= 60 ? 'B' : score >= 40 ? 'C' : 'D',
      feedback
    };
  }
}

module.exports = BlogAIAssistant;