<header class="site-header" style="background: rgba(10,10,10,0.6); backdrop-filter: blur(20px); padding: 0.2rem 0;">
  <nav class="navbar">
    <div class="container">
      <div class="navbar-brand">
        <a href="{{ '/' | relative_url }}" class="logo">
          <span class="logo-text" {% if page.url contains '/blog/' or page.layout == 'blog-post' or page.layout == 'blog' %}style="color: #ffffff !important;"{% endif %}>LeadFive</span>
        </a>
      </div>
      
      <button class="mobile-menu-toggle navbar-toggler" id="navbarToggler" type="button" aria-label="Toggle navigation" aria-controls="mobileNav" aria-expanded="false" onclick="toggleNavbarMenu(); return false;" style="z-index:10002;">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
      <!-- Unified navigation for all pages (same structure as top page) -->
      <ul class="navbar-nav" id="mobileNav">
        <li class="nav-item"><a href="{{ site.baseurl }}/#philosophy" class="nav-link" onclick="closeMobileMenu && closeMobileMenu()">理念</a></li>
        <li class="nav-item"><a href="{{ site.baseurl }}/#services" class="nav-link" onclick="closeMobileMenu && closeMobileMenu()">強み</a></li>
        <li class="nav-item"><a href="{{ site.baseurl }}/case-studies/" class="nav-link" onclick="closeMobileMenu && closeMobileMenu()">実績</a></li>
        <li class="nav-item"><a href="{{ site.baseurl }}/blog/" class="nav-link" onclick="closeMobileMenu && closeMobileMenu()">ブログ</a></li>
        <li class="nav-item"><a href="#" class="btn btn-primary nav-cta" onclick="openContactForm(); closeMobileMenu && closeMobileMenu(); return false;">お問い合わせ</a></li>
      </ul>
    </div>
  </nav>
</header>

<style>
/* Normalize header height and vertical centering across pages */
.site-header .logo-text,
.site-header .nav-link,
.site-header .nav-cta {
  display: inline-flex;
  align-items: center;
  height: 36px;
  line-height: 1;
}
.site-header .nav-link { padding: 0 10px; }

/* Ensure hamburger spans are visible across pages */
.site-header .navbar-toggler span {
  display: block; width: 22px; height: 2px; background: rgba(255,255,255,0.9);
  margin: 4px 0; border-radius: 1px; transition: all .3s ease;
}

/* Mobile nav behavior on non-home pages only */
@media (max-width: 768px) {
  /* Make sure the hamburger button itself is shown */
  body:not(.homepage) .site-header .mobile-menu-toggle,
  body:not(.homepage) .site-header .navbar-toggler { display: inline-flex; align-items: center; justify-content: center; }

  /* Ensure visible burger geometry on subpages */
  body:not(.homepage) .site-header .mobile-menu-toggle .hamburger {
    width: 28px; height: 20px; position: relative; display: inline-block;
  }
  body:not(.homepage) .site-header .mobile-menu-toggle .hamburger span {
    position: absolute; left: 0; width: 100%; height: 2px; background: #ffffff; border-radius: 1px;
  }
  body:not(.homepage) .site-header .mobile-menu-toggle .hamburger span:nth-child(1) { top: 0; }
  body:not(.homepage) .site-header .mobile-menu-toggle .hamburger span:nth-child(2) { top: 50%; transform: translateY(-50%); }
  body:not(.homepage) .site-header .mobile-menu-toggle .hamburger span:nth-child(3) { bottom: 0; }

  body:not(.homepage) .site-header .navbar-nav {
    display: none;
    position: fixed; top: 60px; left: 0; right: 0;
    background: rgba(10,10,10,0.98); backdrop-filter: blur(10px);
    padding: 2rem; z-index: 1001;
    flex-direction: column; gap: 1rem;
  }
  body:not(.homepage) .site-header .navbar-nav.active {
    display: flex !important;
  }
}
</style>

<!-- Mobile menu is handled by main.js -->
<script>
// Fallback: ensure hamburger works on non-home pages independently of main.js
document.addEventListener('DOMContentLoaded', function() {
  try {
    // If main.js initialized menu, skip fallback binding
    if (window.__MOBILE_MENU_READY__) return;
    // Defer slightly to let main.js run first and set the guard
    setTimeout(function() {
      if (window.__MOBILE_MENU_READY__) return;
      var btn = document.querySelector('.site-header .mobile-menu-toggle') || document.getElementById('navbarToggler');
      var nav = document.getElementById('mobileNav');
      if (!btn || !nav) return;
      function open() {
        nav.classList.add('active');
        btn.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
      function close() {
        nav.classList.remove('active');
        btn.classList.remove('active');
        document.body.style.overflow = '';
      }
      function toggle(e) {
        if (e) { e.preventDefault(); e.stopPropagation(); }
        if (nav.classList.contains('active')) close(); else open();
      }
      // Keep fallback minimal: click only to reduce double-trigger risk
      btn.addEventListener('click', toggle, { passive: false });
      document.addEventListener('click', function(e) {
        if (nav.classList.contains('active') && !e.target.closest('#mobileNav') && !e.target.closest('.mobile-menu-toggle')) close();
      }, { passive: true });
      // Expose for inline calls (compat with onclick)
      window.closeMobileMenu = window.closeMobileMenu || close;
      window.toggleNavbarMenu = window.toggleNavbarMenu || toggle;
    }, 120);
  } catch (err) { /* no-op */ }
});
</script>
