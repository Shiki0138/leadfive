#!/usr/bin/env node

/**
 * SEO最適化ブログ記事生成のための高度なプロンプトシステム
 */

const seoWritingPrompts = {
  // メインプロンプトテンプレート
  mainPrompt: `あなたはSEOとコンテンツマーケティングの専門家です。
以下の条件に従って、検索上位表示を狙える高品質なブログ記事を作成してください。

## 🎯 目標
1. 指定キーワードで検索上位3位以内を目指す
2. 検索ユーザーの検索意図を完全に満たす
3. 最後まで読まれる心理的訴求を含める
4. 常識を覆す新しい視点で読者の興味を引く

## 📝 記事作成の手順

### ステップ1: 検索意図の分析
キーワード「{keyword}」について、以下を分析してください：

1. **検索ユーザーのペルソナ**
   - どんな人が検索するか
   - どんな悩みや課題を持っているか
   - どんな情報を求めているか

2. **検索意図の分類**
   - Informational（情報収集型）
   - Navigational（特定サイト探し型）
   - Transactional（購買行動型）
   - Commercial（比較検討型）

3. **競合上位3記事の分析**
   以下の観点で仮想的に上位3記事を分析：
   - 共通して扱っているトピック
   - ユニークな価値提供
   - 記事構成と流れ
   - 不足している情報

### ステップ2: タイトル案の作成
以下の要素を含む、クリックしたくなるタイトルを5つ提案：

1. **数字を含む**（例：3つの方法、5つのステップ）
2. **ベネフィット明示**（読者が得られる価値）
3. **緊急性・希少性**（今すぐ読む理由）
4. **感情トリガー**（驚き、好奇心、不安解消）
5. **キーワード配置**（自然な形で前半に）

タイトル例のフォーマット：
- 【{year}年最新】{keyword}完全ガイド｜{benefit}を実現する{number}つの方法
- {keyword}で{result}を達成！{target}が注目する{method}とは
- なぜ{competitor}は{keyword}で成功したのか？{time}で{achievement}した秘密

### ステップ3: 記事構成の設計【結論ファースト型】

## 必須構成要素

### 1. リード文（150-200文字）
**衝撃的な結論から始める**：
- 常識を覆す事実を最初に提示
- 「実は〜は間違いだった」という切り口
- なぜその結論に至ったかの予告
- 読み進める価値の明示

### 2. 見出し構成（h2: 3-4個、h3: 必要に応じて）
```
## 結論: {keyword}の真実は〇〇だった
   → 画像挿入位置
   - 衝撃的な事実を端的に
   - 従来の常識との対比
   - この結論がもたらすインパクト

## なぜ多くの人が{keyword}を誤解しているのか
   → 画像挿入位置
   - 一般的な認識の間違いを指摘
   - その誤解が生まれた背景
   - データや事例で誤解を証明

## {keyword}の本当の効果を実証する3つの根拠
   → 画像挿入位置
   - 科学的データ
   - 実際の成功事例
   - 専門家の見解

## 今すぐ実践できる{keyword}の正しい活用法
   - 新しい認識に基づくアプローチ
   - 具体的なステップ
   - 期待できる成果
```

### 3. 内部リンク設置
- {{INTERNAL_LINK:関連トピック}} 形式で5-7箇所
- 文脈に自然に溶け込む配置
- 新旧記事をバランスよく

### 4. 画像配置
- {{IMAGE:説明テキスト}} 形式で各h2直下に配置
- 視覚的な理解を助ける位置

## 📊 SEO最適化チェックリスト
- [ ] キーワード密度: 2-3%（自然な配置）
- [ ] 関連キーワード: 5-10個使用
- [ ] メタディスクリプション: 120-150文字
- [ ] 見出しにキーワード: h2の50%以上
- [ ] 文字数: 2500-3000文字
- [ ] 段落: 3-5文で区切る
- [ ] 箇条書き: 適度に使用

## 🧠 心理的訴求テクニック【常識を覆すアプローチ】
1. **認知的不協和**: 「えっ、そうだったの？」という驚き
2. **常識の否定**: 「実は〜は効果がなかった」
3. **新事実の提示**: 「最新の研究で判明した〜」
4. **逆説的アプローチ**: 「〜しない方が成功する理由」
5. **パラダイムシフト**: 「これまでの常識が変わる」

### 常識を覆す表現例
- 「実は、{一般的な方法}は逆効果だった」
- 「{権威ある情報}には致命的な欠陥があった」
- 「誰もが信じている{常識}の嘘」
- 「なぜ{成功者}は{一般的でない方法}を選ぶのか」
- 「{常識}を捨てた企業が成功する本当の理由」

出力形式:
1. 検索意図分析結果
2. タイトル案5つ
3. 完全な記事本文（上記構成に従う）`,

  // 検索意図分析プロンプト
  searchIntentPrompt: `キーワード「{keyword}」で検索するユーザーの検索意図を詳細に分析してください。

1. **プライマリーインテント（主要な目的）**
   - 何を知りたいのか
   - 何を解決したいのか
   - どんな行動を起こしたいのか

2. **セカンダリーインテント（副次的な目的）**
   - 関連して知りたいこと
   - 潜在的なニーズ
   - 次のステップ

3. **ユーザーの状況**
   - 知識レベル（初心者/中級者/上級者）
   - 緊急度
   - 予算感覚
   - 意思決定段階

4. **競合コンテンツ分析（仮想）**
上位表示されそうな記事の特徴：
   - トピックの網羅性
   - 独自性のある情報
   - ユーザビリティ
   - 信頼性の担保方法

5. **コンテンツギャップ**
   - 既存記事で不足している情報
   - ユーザーが本当に求めている情報
   - 差別化ポイント`,

  // タイトル生成プロンプト
  titleGenerationPrompt: `以下の条件でSEOに強く、クリック率の高いタイトルを5つ作成してください。

キーワード: {keyword}
検索意図: {searchIntent}
ターゲット: {targetAudience}

## タイトル作成ルール

1. **文字数**: 28-35文字（表示最適化）
2. **キーワード配置**: 前半15文字以内に配置
3. **数字の使用**: 具体的な数値を含める
4. **感情トリガー**: 以下から1つ以上使用
   - 好奇心（〜とは、なぜ〜）
   - 利益（〜する方法、〜のコツ）
   - 恐怖回避（〜しないと、〜の落とし穴）
   - 社会的証明（〜が選ぶ、〜で話題）
   - 権威性（専門家が教える、〜認定）
   - 緊急性（今すぐ、2025年版）

5. **クリック要素**:
   - 【】で重要性を強調
   - ｜で情報を区切る
   - 数字は半角使用
   - 年号は西暦4桁

## 評価基準
各タイトルに以下のスコアを付けてください：
- SEO適合度（1-5）
- クリック訴求力（1-5）
- 検索意図との一致度（1-5）`,

  // 記事構成プロンプト
  articleStructurePrompt: `以下の構成で、SEO最適化された記事の詳細なアウトラインを作成してください。

## 基本情報
- キーワード: {keyword}
- 選択タイトル: {selectedTitle}
- 検索意図: {searchIntent}
- ターゲット読者: {targetAudience}

## 記事構成テンプレート

### 導入部（リード文）- 150-200文字
目的: 3秒で読者の心を掴む
要素:
1. 共感フック（読者の悩みに寄り添う）
2. 記事の価値提示（何が得られるか）
3. 読了後のベネフィット

### 本文構成

#### h2: {見出し1} - 基礎知識・背景
- 検索キーワードの定義や基本概念
- なぜ今重要なのか
- {{IMAGE:概念図やインフォグラフィック}}
- {{INTERNAL_LINK:基礎知識の関連記事}}

#### h2: {見出し2} - 具体的な方法・ステップ
- 実践的なハウツー
- ステップバイステップの説明
- {{IMAGE:手順や流れ図}}
- チェックリストや箇条書き
- {{INTERNAL_LINK:実践ガイド}}

#### h2: {見出し3} - 事例・応用・注意点
- 成功事例の紹介
- よくある失敗パターン
- {{IMAGE:事例やビフォーアフター}}
- 応用テクニック
- {{INTERNAL_LINK:事例集}}

#### h2: まとめ - アクションプラン
- 要点の整理（箇条書き3-5個）
- 次のステップの提示
- CTA（問い合わせ、関連サービス）
- {{INTERNAL_LINK:次に読むべき記事}}

### SEO要素の配置
- キーワード出現: 各セクションに1-2回
- 関連キーワード: 自然に散りばめる
- 内部リンク: 5-7箇所（過去記事3、新記事2、サービス2）`,

  // 心理訴求テクニック
  psychologicalTechniques: {
    hooks: {
      empathy: "「{pain}」そんな悩みを抱えていませんか？",
      curiosity: "実は、{keyword}には多くの人が知らない{secret}があります。",
      benefit: "この記事を読めば、{time}後には{result}できるようになります。",
      authority: "{expert}も推奨する{keyword}の活用法とは？",
      social_proof: "すでに{number}人が実践して成果を出している{method}",
      urgency: "今知らないと損する、{year}年の{keyword}最新情報",
      fear: "{keyword}を間違えると{risk}になる可能性が...",
    },
    
    transitions: {
      addition: "さらに重要なポイントとして...",
      contrast: "一方で、見落としがちな点が...",
      cause: "なぜなら、{reason}だからです。",
      example: "具体的な例を挙げると...",
      emphasis: "特に注目すべきは...",
      conclusion: "つまり、{keyword}で成功するには...",
    },
    
    closings: {
      summary: "ここまで{keyword}について解説してきました。",
      action: "今すぐ実践できる第一歩は...",
      benefit_reminder: "この方法を実践すれば、{benefit}が期待できます。",
      next_step: "さらに詳しく知りたい方は...",
      urgency: "今がまさに{keyword}を始める最適なタイミングです。",
    }
  },

  // 内部リンク戦略
  internalLinkStrategy: `内部リンクは以下の戦略で配置:

1. **関連性の高い記事**（3箇所）
   - 同じカテゴリーの詳細記事
   - 前提知識となる基礎記事
   - 応用・発展的な内容

2. **ユーザージャーニー**（2箇所）
   - 次に読むべき記事
   - 関連する悩み解決記事

3. **サービスページ**（2箇所）
   - 関連サービスの紹介
   - お問い合わせ・相談ページ

配置ルール:
- 文脈に自然に溶け込む
- アンカーテキストは説明的に
- 前半・中盤・後半にバランスよく`,

  // 最終チェックリスト
  finalChecklist: `
## 📋 記事公開前の最終チェック

### SEO要素
- [ ] タイトルタグ: 28-35文字、キーワード前半配置
- [ ] メタディスクリプション: 120-150文字、CTAを含む
- [ ] h2タグ: 3-4個、キーワード含有率50%以上
- [ ] キーワード密度: 2-3%（自然な配置）
- [ ] 内部リンク: 5-7箇所設置
- [ ] 画像alt属性: 説明的なテキスト

### コンテンツ品質
- [ ] 検索意図への回答: 完全に満たしている
- [ ] 独自性: 他記事にない価値提供
- [ ] 読みやすさ: 段落、箇条書き、適切な改行
- [ ] 信頼性: データ、事例、根拠の提示
- [ ] 行動喚起: 明確なネクストステップ

### ユーザビリティ
- [ ] モバイル最適化: スマホでも読みやすい
- [ ] 表示速度: 画像最適化
- [ ] スキャンしやすさ: 見出しで内容把握可能
- [ ] エンゲージメント: 最後まで読みたくなる工夫`
};

// プロンプト生成関数
function generateSEOPrompt(keyword, options = {}) {
  const {
    targetAudience = '企業の意思決定者',
    contentType = 'informational',
    competitorCount = 3,
    wordCount = 3000
  } = options;

  let prompt = seoWritingPrompts.mainPrompt
    .replace(/{keyword}/g, keyword)
    .replace(/{year}/g, new Date().getFullYear())
    .replace(/{targetAudience}/g, targetAudience);

  // 検索意図に応じた追加指示
  if (contentType === 'commercial') {
    prompt += '\n\n## 商業的意図への対応\n- 製品/サービスの比較表を含める\n- 価格や費用対効果に言及\n- 選び方のポイントを明確に';
  } else if (contentType === 'transactional') {
    prompt += '\n\n## 購買意図への対応\n- 具体的な行動ステップ\n- 申込み・購入方法\n- よくある質問と回答';
  }

  return prompt;
}

// タイトル評価関数
function evaluateTitle(title, keyword) {
  const scores = {
    seo: 0,
    clickability: 0,
    intent_match: 0
  };

  // SEOスコア
  if (title.includes(keyword)) scores.seo += 2;
  if (title.indexOf(keyword) < 15) scores.seo += 2;
  if (title.length >= 28 && title.length <= 35) scores.seo += 1;

  // クリック訴求力
  if (/\d+/.test(title)) scores.clickability += 1;
  if (/【|】|｜/.test(title)) scores.clickability += 1;
  if (/方法|コツ|秘訣|ガイド/.test(title)) scores.clickability += 1;
  if (/なぜ|どう|何/.test(title)) scores.clickability += 1;
  if (/最新|2025|完全/.test(title)) scores.clickability += 1;

  // 意図との一致（仮評価）
  scores.intent_match = 3; // デフォルト中間値

  return scores;
}

// エクスポート
module.exports = {
  seoWritingPrompts,
  generateSEOPrompt,
  evaluateTitle
};

// CLIテスト実行
if (require.main === module) {
  const keyword = process.argv[2] || 'AIマーケティング 自動化';
  console.log('='.repeat(60));
  console.log('SEO最適化プロンプト生成');
  console.log('='.repeat(60));
  console.log('\nキーワード:', keyword);
  console.log('\n生成されたプロンプト:');
  console.log('-'.repeat(60));
  console.log(generateSEOPrompt(keyword));
}