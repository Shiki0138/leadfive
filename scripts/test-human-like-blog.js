#!/usr/bin/env node

const { GoogleGenerativeAI } = require('@google/generative-ai');

// Gemini APIè¨­å®š
const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
const DEFAULT_GEMINI_MODEL = process.env.GEMINI_MODEL || 'gemini-2.5-flash-lite';

async function generateContentWithAI(prompt) {
  const systemPrompt = `ã‚ãªãŸã¯LeadFiveã®AIÃ—å¿ƒç†å­¦ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®å°‚é–€å®¶ã§ã™ã€‚
ä¾é ¼ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ç¦æ­¢äº‹é …ã‚’å³å¯†ã«å®ˆã‚ŠãªãŒã‚‰ã€å˜ä¸€ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

å¿…ãšå®ˆã‚‹ã¹ãå‰ææ¡ä»¶:
1. æ–‡å­—æ•°ã¯ãŠãŠã‚ˆã1800ã€œ2200æ–‡å­—
2. æŒ‡ç¤ºã•ã‚ŒãŸè¦‹å‡ºã—ã‚„å°è¦‹å‡ºã—ã®é †ç•ªãƒ»è¡¨è¨˜ã‚’å¤‰æ›´ã—ãªã„
3. æœ¬æ–‡ã«å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚„URLã‚’æŒ¿å…¥ã—ãªã„
4. CTAæ–‡è¨€ã‚„ã€Œç„¡æ–™ç›¸è«‡ã¯ã“ã¡ã‚‰ã€ã¨ã„ã£ãŸç›´æ¥çš„ãªå–¶æ¥­æ–‡å¥ã‚’æœ¬æ–‡å†…ã§ä½¿ã‚ãªã„
5. 1ã¤ã®è¨˜äº‹ã®ã¿ã‚’ç”Ÿæˆã—ã€åˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„è¿½è¨˜ã‚’å«ã‚ãªã„
6. æ—¥æœ¬èªã§åŸ·ç­†ã—ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã ãŒè¦ªã—ã¿ã‚„ã™ã„ãƒˆãƒ¼ãƒ³ã‚’ç¶­æŒã™ã‚‹

ã€äººé–“ã‚‰ã—ã„æ–‡ç« ã‚’æ›¸ããŸã‚ã®10ã®åŸå‰‡ã€‘
1. å€‹äººçš„ãªçµŒé¨“ã‚„ä½“é¨“è«‡ã‚’1ã¤ä»¥ä¸Šå…¥ã‚Œã‚‹ï¼ˆå…·ä½“çš„ãªã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã§å…±æ„Ÿã‚’ç”Ÿã‚€ï¼‰
2. æ„Ÿæƒ…è¡¨ç¾ï¼ˆé©šããƒ»å…±æ„Ÿãƒ»è‘›è—¤ãªã©ï¼‰ã‚’è‡ªç„¶ã«ç¹”ã‚Šè¾¼ã‚€
3. æ–‡ã®é•·ã•ã«ãƒãƒ©ã¤ãã‚’å‡ºã™ï¼ˆçŸ­æ–‡5ã€œ10æ–‡å­—ã€é•·æ–‡30ã€œ50æ–‡å­—ã‚’ãƒªã‚ºãƒŸã‚«ãƒ«ã«é…ç½®ï¼‰
4. èª­è€…ã«ç›´æ¥èªã‚Šã‹ã‘ã‚‹ï¼ˆä¾‹ï¼šã€Œã‚ãªãŸã‚‚æ„Ÿã˜ãŸã“ã¨ãŒã‚ã‚‹ã¯ãšã§ã™ã€ï¼‰
5. å±•é–‹ã«å°‘ã—æ„å¤–æ€§ã‚’æŒãŸã›ã‚‹ï¼ˆäºˆæ¸¬å¯èƒ½ãªå±•é–‹ã‚’é¿ã‘ã‚‹ï¼‰
6. å°‚é–€ç”¨èªã¯å¿…ãšæ—¥å¸¸èªã§èª¬æ˜ã™ã‚‹ï¼ˆé›£ã—ã„è¨€è‘‰ã®å¾Œã«ã€Œã¤ã¾ã‚Šã€œã€ã‚’æ·»ãˆã‚‹ï¼‰
7. æŠ½è±¡æ¦‚å¿µã¯å…·ä½“ä¾‹ã§è£œè¶³ã™ã‚‹ï¼ˆç†è«–ã ã‘ã§ãªãã€å®Ÿä¾‹ãƒ»æ¯”å–©ã‚’ä½¿ã†ï¼‰
8. ç–‘å•æ–‡ãƒ»æ„Ÿå˜†æ–‡ã‚’1ã€œ2å›ç¹”ã‚Šäº¤ãœã‚‹ï¼ˆèª­è€…ã®æ€è€ƒã‚’åˆºæ¿€ã™ã‚‹ï¼‰
9. æ•°å­—ã‚„ãƒ‡ãƒ¼ã‚¿ã«æ„Ÿæƒ…ã‚’é‡ã­ã‚‹ï¼ˆä¾‹ï¼šã€ŒãŸã£ãŸ3ç§’ã§å¿ƒãŒå‹•ãã€ã€Œé©šãã®85%ãŒå®Ÿæ„Ÿã€ï¼‰
10. ç¾ä»£ã®æ–‡åŒ–ãƒ»æ™‚äº‹ã‚’1ã¤å¼•ç”¨ã™ã‚‹ï¼ˆ2024-2025å¹´ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‚„è©±é¡Œï¼‰

`;

  try {
    const model = genAI.getGenerativeModel({ model: DEFAULT_GEMINI_MODEL });
    const result = await model.generateContent(systemPrompt + prompt);
    const response = await result.response;
    return response.text();
  } catch (error) {
    console.error('Gemini API ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
}

async function generateSampleBlogPost() {
  const currentYear = new Date().getFullYear();
  const theme = 'AIãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°';
  const keyword = 'ç”Ÿå­˜æœ¬èƒ½';
  const instinct = 'survival';
  const structure = 'howTo';

  // ã‚¿ã‚¤ãƒˆãƒ«ã®ç”Ÿæˆ
  const titlePrompt = `
ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ãƒ–ãƒ­ã‚°è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’1ã¤ä½œæˆã—ã¦ãã ã•ã„ã€‚
- ãƒ†ãƒ¼ãƒ: ${theme}
- è»¸ã¨ãªã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${keyword}
- è¨´æ±‚ã™ã‚‹æœ¬èƒ½: ${instinct}
- æ§‹é€ ã‚¿ã‚¤ãƒ—: ${structure}
- ç¾åœ¨ã®å¹´: ${currentYear}å¹´
- æ–‡å­—æ•°: 60æ–‡å­—ä»¥å†…
- æ•°å­—ã‚’å¿…ãšå«ã‚ã‚‹ï¼ˆä¾‹ï¼š${currentYear}å¹´ç‰ˆã€5ã¤ã®ãƒã‚¤ãƒ³ãƒˆ ãªã©ï¼‰
- SEOã‚’æ„è­˜ã—ã€ä¸»è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªç„¶ã«å«ã‚ã‚‹
- èˆˆå‘³ã‚’å¼•ãå…·ä½“çš„ãªè¡¨ç¾ã«ã™ã‚‹

å‡ºåŠ›å½¢å¼:
ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿ã‚’1è¡Œã§è¿”ã—ã¦ãã ã•ã„ã€‚å…ˆé ­ã‚„æœ«å°¾ã«å¼•ç”¨ç¬¦ãƒ»è¨˜å·ãƒ»è¦‹å‡ºã—è¨˜å·ã‚’ä»˜ã‘ãšã€è§£èª¬æ–‡ã‚„ä½™è¨ˆãªæ–‡ç« ã‚’è¿½åŠ ã—ãªã„ã§ãã ã•ã„ã€‚
`;

  console.log('ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç”Ÿæˆä¸­...');
  const titleRaw = await generateContentWithAI(titlePrompt);
  const title = titleRaw.split('\n').find(line => line.trim()).trim()
    .replace(/^["'`#]+|["'`#]+$/g, '')
    .replace(/^(?:ã‚¿ã‚¤ãƒˆãƒ«[:ï¼š]\s*)/i, '');

  console.log(`âœ… ã‚¿ã‚¤ãƒˆãƒ«: ${title}\n`);

  // è¨˜äº‹å†…å®¹ã®ç”Ÿæˆ
  const contentPrompt = `
ä»¥ä¸‹ã®æ¡ä»¶ã§LeadFiveå…¬å¼ãƒ–ãƒ­ã‚°å‘ã‘ã®è¨˜äº‹ã‚’Markdownå½¢å¼ã§åŸ·ç­†ã—ã¦ãã ã•ã„ã€‚

ã€åŸ·ç­†æ¡ä»¶ã€‘
- ã‚¿ã‚¤ãƒˆãƒ«: ${title}
- ãƒ†ãƒ¼ãƒ: ${theme}
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${keyword}
- æœ¬èƒ½: ${instinct}
- æ§‹é€ ã‚¿ã‚¤ãƒ—: ${structure}
- æ–‡å­—æ•°ç›®å®‰: 1800ã€œ2200æ–‡å­—
- ãƒˆãƒ¼ãƒ³: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã ãŒè¦ªã—ã¿ã‚„ã™ã„
- LeadFiveã®AIÃ—å¿ƒç†å­¦ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®çŸ¥è¦‹ã‚’è‡ªç„¶ã«ç¹”ã‚Šè¾¼ã‚€
- å†’é ­ã«200æ–‡å­—å‰å¾Œã®ãƒªãƒ¼ãƒ‰æ®µè½ï¼ˆè¦‹å‡ºã—ãªã—ï¼‰ã‚’é…ç½®ã—ã€ãã®å¾Œã«è¦‹å‡ºã—æ§‹æˆã‚’ç¶šã‘ã‚‹

ã€ãƒªãƒ¼ãƒ‰æ®µè½ã€‘
- 200æ–‡å­—å‰å¾Œã§èª­è€…ã®èª²é¡Œã«å…±æ„Ÿã—ã€è¨˜äº‹ã‚’èª­ã‚€ãƒ¡ãƒªãƒƒãƒˆã‚’æç¤ºã™ã‚‹ï¼ˆè¦‹å‡ºã—ãªã—ï¼‰

ã€æœ¬æ–‡æ§‹æˆã€‘
## ${instinct}ã®å¿ƒç†å­¦çš„èƒŒæ™¯
- æœ¬èƒ½ã®æ¦‚è¦ã¨ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ´»ç”¨ãƒã‚¤ãƒ³ãƒˆã‚’æ•´ç†

## ${theme}ã®æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- ${structure}æ§‹é€ ã®è¦–ç‚¹ã§å¸‚å ´å‹•å‘ã¨èª²é¡Œã‚’èª¬æ˜

## å®Ÿè·µã‚¹ãƒ†ãƒƒãƒ—
### ã‚¹ãƒ†ãƒƒãƒ—1: æº–å‚™ã¨è¨ˆç”»
### ã‚¹ãƒ†ãƒƒãƒ—2: å®Ÿè£…ã¨å®Ÿè¡Œ
### ã‚¹ãƒ†ãƒƒãƒ—3: æ¸¬å®šã¨æ”¹å–„
- å„ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œå†…å®¹ãƒ»æŒ‡æ¨™ãƒ»æ³¨æ„ç‚¹ã‚’å…·ä½“çš„ã«è§£èª¬

## æˆåŠŸäº‹ä¾‹ã¨æœŸå¾…ã§ãã‚‹åŠ¹æœ
- æ•°å€¤ä¾‹ã‚„æˆæœæŒ‡æ¨™ã‚’äº¤ãˆã¦å°å…¥åŠ¹æœã‚’èª¬æ˜

## ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- ç®‡æ¡æ›¸ãã§3ã¤ã®å®Ÿè¡Œãƒã‚¤ãƒ³ãƒˆã‚’æ•´ç†
- æœ€å¾Œã®1æ–‡ã ã‘ã§LeadFiveã¸ã®ç›¸è«‡ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã«è§¦ã‚Œã‚‹

ã€ç¦æ­¢äº‹é …ãƒ»æ³¨æ„äº‹é …ã€‘
- æœ¬æ–‡å†…ã§è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’å†æ²ã—ãªã„
- æœ¬æ–‡å†…ã«URLã‚„å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚’æŒ¿å…¥ã—ãªã„
- ã€Œç„¡æ–™ç›¸è«‡ã¯ã“ã¡ã‚‰ã€ã€ŒãŠå•ã„åˆã‚ã›ã¯ã“ã¡ã‚‰ã€ãªã©ã®CTAæ–‡è¨€ã‚’æœ¬æ–‡ã§ä½¿ç”¨ã—ãªã„
- æ ¹æ‹ ã®ãªã„æ–­å®šã‚’é¿ã‘ã€ãƒ‡ãƒ¼ã‚¿ã‚„äº‹ä¾‹ã‚’ç¤ºã™éš›ã¯ã€Œä¾‹ã€ã€Œæƒ³å®šã€ãªã©ã®ã‚¯ãƒƒã‚·ãƒ§ãƒ³èªã‚’æ·»ãˆã‚‹
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã¯1è¡Œã®ç©ºè¡Œã§åŒºåˆ‡ã‚‹

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€Œ${keyword}ã€ã‚’è‡ªç„¶ãªæ–‡è„ˆã§3ã€œ5å›ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
`;

  console.log('ğŸ“ è¨˜äº‹æœ¬æ–‡ã‚’ç”Ÿæˆä¸­...\n');
  const content = await generateContentWithAI(contentPrompt);

  return {
    title,
    content
  };
}

// å®Ÿè¡Œ
if (require.main === module) {
  console.log('ğŸš€ äººé–“ã‚‰ã—ã„æ–‡ç« ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ç”Ÿæˆã—ã¾ã™\n');
  console.log('='.repeat(60) + '\n');

  generateSampleBlogPost()
    .then(post => {
      console.log('='.repeat(60));
      console.log('âœ¨ ã‚µãƒ³ãƒ—ãƒ«è¨˜äº‹ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\n');
      console.log('ã€ã‚¿ã‚¤ãƒˆãƒ«ã€‘');
      console.log(post.title);
      console.log('\nã€æœ¬æ–‡ã€‘');
      console.log(post.content);
      console.log('\n' + '='.repeat(60));
      console.log(`ğŸ“ æ–‡å­—æ•°: ${post.content.length} æ–‡å­—`);
    })
    .catch(error => {
      console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
      process.exit(1);
    });
}

module.exports = { generateSampleBlogPost };
